/* Phaser Particle Storm Plugin v1.0.0 (C) Copyright 2015 Photon Storm Ltd. */
Phaser.ParticleStorm=function(a,b){Phaser.Plugin.call(this,a,b),this.emitters=[],this.dataList={};var c=PIXI.canUseNewCanvasBlendModes();this.blendModeMap={NORMAL:[0,"source-over"],ADD:[1,"lighter"],MULTIPLY:[2,c?"multiply":"source-over"],SCREEN:[3,c?"screen":"source-over"],OVERLAY:[4,c?"overlay":"source-over"],DARKEN:[5,c?"darken":"source-over"],LIGHTEN:[6,c?"lighten":"source-over"],COLOR_DODGE:[7,c?"color-dodge":"source-over"],COLOR_BURN:[8,c?"color-burn":"source-over"],HARD_LIGHT:[9,c?"hard-light":"source-over"],SOFT_LIGHT:[10,c?"soft-light":"source-over"],DIFFERENCE:[11,c?"difference":"source-over"],EXCLUSION:[12,c?"exclusion":"source-over"],HUE:[13,c?"hue":"source-over"],SATURATION:[14,c?"saturation":"source-over"],COLOR:[15,c?"color":"source-over"],LUMINOSITY:[16,c?"luminosity":"source-over"]},this.hsv=Phaser.Color.HSVColorWheel()},Phaser.ParticleStorm.prototype=Object.create(Phaser.Plugin.prototype),Phaser.ParticleStorm.prototype.constructor=Phaser.ParticleStorm,Phaser.ParticleStorm.SPRITE="sprite",Phaser.ParticleStorm.PIXEL="pixel",Phaser.ParticleStorm.RENDERTEXTURE="render texture",Phaser.ParticleStorm.SPRITE_BATCH="sprite batch",Phaser.ParticleStorm.BITMAP_DATA="bitmap data",Phaser.ParticleStorm.BASE={value:0,initial:0,delta:0,offset:0,control:null,calc:0},Phaser.ParticleStorm.BASE_1={value:1,initial:0,delta:0,offset:0,control:null,calc:1},Phaser.ParticleStorm.BASE_255={value:0,initial:0,delta:0,offset:0,min:0,max:255,control:null,calc:0},Phaser.ParticleStorm.BASE_359={value:0,initial:0,delta:0,offset:0,min:0,max:359,control:null,calc:0},Phaser.ParticleStorm.BASE_NULL={value:null,initial:0,delta:0,offset:0,control:null,calc:0},Phaser.ParticleStorm.BASE_EMIT={name:null,value:0,initial:0,control:null,at:null,inherit:!0,offsetX:0,offsetY:0},Phaser.ParticleStorm.Controls={},Phaser.ParticleStorm.Zones={},Phaser.ParticleStorm.prototype.createEmitter=function(a,b,c){var d=new Phaser.ParticleStorm.Emitter(this,a,b,c);return this.emitters.push(d),d},Phaser.ParticleStorm.prototype.removeEmitter=function(a){for(var b=0;b<this.emitters.length;b++)if(this.emitters[b]===a)return void this.emitters.splice(b,1)},Phaser.ParticleStorm.prototype.addData=function(a,b){if(void 0===a)return this;if(Array.isArray(a))for(var c=0;c<a.length;c++)this.dataList[a[c]]=this.game.cache.getJSON(a[c]);else void 0!==b?this.dataList[a]=b:this.dataList[a]=this.game.cache.getJSON(a);return this},Phaser.ParticleStorm.prototype.getData=function(a){return this.dataList[a]},Phaser.ParticleStorm.prototype.clearData=function(a){if(void 0===a)this.dataList={};else if(Array.isArray(a))for(var b=0;b<a.length;b++)delete this.dataList[a[b]];else delete this.dataList[a];return this},Phaser.ParticleStorm.prototype.cloneData=function(a,b){if(void 0===a)return this;if(Array.isArray(a))for(var c=0;c<a.length;c++)this.dataList[a[c]]=Phaser.Utils.extend(!0,this.game.cache.getJSON(a[c]));else void 0!==b?this.dataList[a]=Phaser.Utils.extend(!0,b):this.dataList[a]=Phaser.Utils.extend(!0,this.game.cache.getJSON(a));return this},Phaser.ParticleStorm.prototype.createPointZone=function(a,b){return new Phaser.ParticleStorm.Zones.Point(this.game,a,b)},Phaser.ParticleStorm.prototype.createLineZone=function(a,b,c,d){return new Phaser.ParticleStorm.Zones.Line(this.game,a,b,c,d)},Phaser.ParticleStorm.prototype.createRectangleZone=function(a,b){return new Phaser.ParticleStorm.Zones.Rectangle(this.game,a,b)},Phaser.ParticleStorm.prototype.createCircleZone=function(a){return new Phaser.ParticleStorm.Zones.Circle(this.game,a)},Phaser.ParticleStorm.prototype.createEllipseZone=function(a,b){return new Phaser.ParticleStorm.Zones.Ellipse(this.game,a,b)},Phaser.ParticleStorm.prototype.createLinearSplineZone=function(a,b,c){return new Phaser.ParticleStorm.Zones.Spline(this.game,0,a,b,c)},Phaser.ParticleStorm.prototype.createBezierSplineZone=function(a,b,c){return new Phaser.ParticleStorm.Zones.Spline(this.game,1,a,b,c)},Phaser.ParticleStorm.prototype.createCatmullSplineZone=function(a,b,c){return new Phaser.ParticleStorm.Zones.Spline(this.game,2,a,b,c)},Phaser.ParticleStorm.prototype.createSplineZone=function(a,b,c,d){return new Phaser.ParticleStorm.Zones.Spline(this.game,a,b,c,d)},Phaser.ParticleStorm.prototype.createTextZone=function(a){return new Phaser.ParticleStorm.Zones.Text(this.game,a)},Phaser.ParticleStorm.prototype.createImageZone=function(a){return new Phaser.ParticleStorm.Zones.Image(this.game,a)},Phaser.ParticleStorm.prototype.update=function(){if(this.active)for(var a=0;a<this.emitters.length;a++)this.emitters[a].enabled&&!this.emitters[a].manualUpdate&&this.emitters[a].update()},Phaser.ParticleStorm.Emitter=function(a,b,c,d){this.game=a.game,this.parent=a,this.renderer=null,this.renderType=null,this.graph=Phaser.ParticleStorm.Graph,this.enabled=!1,this.manualUpdate=!1,this.scrollSpeed=new Phaser.Point,this.force=new Phaser.Point,this.onEmit=null,this.onComplete=null,this.onKill=null,this.particleClass=Phaser.ParticleStorm.Particle,this.timer=this.game.time.create(!1),this.timerEvent=null,this.list=[],this.pool=[],this.batch=[],this.wells=[],this._rnd=new Phaser.Point,this._step=new Phaser.Point,this._pCount=0,this._delay={enabled:!1,start:0,inc:0,visible:!1},this.init(b,c,d)},Phaser.ParticleStorm.Emitter.prototype={init:function(a,b,c){void 0===a&&(a=Phaser.ParticleStorm.SPRITE);var d=this.game.width,e=this.game.height;switch(a){case Phaser.ParticleStorm.SPRITE:this.renderer=new Phaser.ParticleStorm.Renderer.Sprite(this);break;case Phaser.ParticleStorm.PIXEL:this.renderer=new Phaser.ParticleStorm.Renderer.Pixel(this,d,e);break;case Phaser.ParticleStorm.RENDERTEXTURE:this.renderer=new Phaser.ParticleStorm.Renderer.RenderTexture(this,d,e);break;case Phaser.ParticleStorm.SPRITE_BATCH:this.renderer=new Phaser.ParticleStorm.Renderer.SpriteBatch(this);break;case Phaser.ParticleStorm.BITMAP_DATA:this.renderer=new Phaser.ParticleStorm.Renderer.BitmapData(this,d,e);break;default:return!1}this.renderType=a,b&&this.force.set(b.x,b.y),c&&this.scrollSpeed.set(c.x,c.y),this.list=[],this.pool=[],this.wells=[],this.enabled=!0},addToWorld:function(a){return void 0===a&&(a=this.game.world),this.renderer.addToWorld(a)},createGravityWell:function(a,b,c,d,e){var f=new Phaser.ParticleStorm.GravityWell(this,a,b,c,d,e);return this.wells.push(f),f},seed:function(a){for(var b=0;a>b;b++){var c=new Phaser.ParticleStorm.Particle(this);this.pool.push(c)}return this},emitDelayed:function(a,b,c,d,e){return!this.enabled||!this.parent.dataList[b]||0>=a?null:(this.timerEvent=this.timer.add(a,this.emit,this,b,c,d,e),this.timer.start(),this.timerEvent)},emit:function(a,b,c,d){if(!this.enabled||!this.parent.dataList[a])return null;if(this.batch=[],this._pCount=0,this._step.x=0,this._step.y=0,void 0===b&&(b=0),void 0===c&&(c=0),!d)return this.emitParticle(a,b,c,null);var e=d.hasOwnProperty("total")?d.total:1;if(d.xStep>0?this._step.x=d.xStep:this._step.x=0,d.yStep>0?this._step.y=d.yStep:this._step.y=0,this._delay.enabled=!1,d.delay&&(this._delay.enabled=!0,"number"==typeof d.delay?(this._delay.start=d.delay,this._delay.step=0,this._delay.visible=!1):(this._delay.start=d.delay.start?d.delay.start:0,this._delay.step=d.delay.step?d.delay.step:0,this._delay.visible=d.delay.visible?!0:!1)),d.zone)if(void 0===d.random&&void 0===d.full&&void 0===d.percent||d.random)d.zone.emit(this,a,b,c,e,d.setAlpha,d.setColor);else if(void 0!==d.percent||void 0===d.full&&d.random){if(void 0!==d.percent){var f=0;"number"==typeof d.percent?f=d.percent:d.percent.hasOwnProperty("min")?f=this.game.rnd.between(d.percent.min,d.percent.max):d.percent.callback&&(f=d.percent.callback.call(d.percent.context,this)),d.zone.emitPercent(this,a,b,c,e,f)}}else d.zone.emitFull(this,a,b,c,d.step,d.spacing,d.setAlpha,d.setColor);else for(var g=0;e>g;g++)this.emitParticle(a,b,c,null);if(d.radiate)for(var h=0;h<this.batch.length;h++)this.batch[h].radiate(d.radiate.velocity,d.radiate.from,d.radiate.to);else if(d.radiateFrom)for(var h=0;h<this.batch.length;h++)this.batch[h].radiateFrom(d.radiateFrom.x,d.radiateFrom.y,d.radiateFrom.velocity);var i=d.hasOwnProperty("repeat")?d.repeat:0;if(0!==i){var j=d.hasOwnProperty("frequency")?d.frequency:250;delete d.repeat,-1===i?this.timerEvent=this.timer.loop(j,this.emit,this,a,b,c,d):i>0&&(this.timerEvent=this.timer.repeat(j,i,this.emit,this,a,b,c,d)),this.timer.start()}return this._pCount=0,this.batch},emitParticle:function(a,b,c,d){var e=this.pool.pop();return e||(e=new this.particleClass(this)),e.parent=d,Array.isArray(b)&&(b=this.game.rnd.between(b[0],b[1])),Array.isArray(c)&&(c=this.game.rnd.between(c[0],c[1])),b+=this._step.x*this._pCount,c+=this._step.y*this._pCount,e.reset(this.renderer,b,c,this.parent.dataList[a]),e.alive?(!d&&this._delay.enabled&&(e.delay+=this._delay.start+this._pCount*this._delay.step,e.delayVisible=this._delay.visible),this.list.push(e),this.batch.push(e),d||this._pCount++):(e.kill(),this.onKill&&this.onKill.dispatch(this,e),this.pool.push(e)),e},update:function(){var a=this.game.time.elapsed;this.renderer.preUpdate();for(var b=this.list.length-1;b>=0;b--){var c=this.list[b];c.ignoreScrollSpeed||(c.transform.x+=this.scrollSpeed.x,c.transform.y+=this.scrollSpeed.y);for(var d=0;d<this.wells.length;d++)this.wells[d].active&&this.wells[d].step(c);c.step(a,this.force)||(c.kill(),this.pool.push(c),this.list.splice(b,1))}return this.renderer.postUpdate(),this.list.length},updateFrequency:function(a,b,c,d){if(a.at){for(var e=0,f=0;f<a.at.length;f++){var g=a.at[f];(g.time>c||0===g.time&&0===c)&&g.time<=d&&(g.value>0&&g.value<1?Math.random()<g.value&&(e+=1):e+=g.value)}return e}return this.graph.getParamArea(a,c,d)*b},forEach:function(a,b){if(arguments.length<=2)for(var c=0;c<this.list.length;c++)a.call(b,this.list[c]);else{for(var d=[null],c=2;c<arguments.length;c++)d.push(arguments[c]);for(var c=0;c<this.list.length;c++)d[0]=this.list[c],a.apply(b,d)}},forEachNew:function(a,b){if(0!==this.batch.length)if(arguments.length<=2)for(var c=0;c<this.batch.length;c++)a.call(b,this.batch[c]);else{for(var d=[null],c=2;c<arguments.length;c++)d.push(arguments[c]);for(var c=0;c<this.batch.length;c++)d[0]=this.batch[c],a.apply(b,d)}},getParticle:function(a){return void 0===a&&(a=0),this.list[a]?this.list[a]:null},debug:function(a,b){var c=this.game.debug;if(c){c.start(a+4,b+16,"rgb(255, 255, 255)",132),c.context.fillStyle="rgba(0, 74, 128, 0.5)",c.context.fillRect(a,b,360,70);var d=this.force.x+"",e=this.force.y+"";c.line("Force:",d.substr(0,8),e.substr(0,8)),c.line("Scroll Speed:",this.scrollSpeed.x,this.scrollSpeed.y),c.line("Alive:","Dead:","Total:"),c.line(this.alive,this.dead,this.total),c.stop()}},destroy:function(){this.renderer.clear&&this.renderer.clear(),this.renderer.destroy(),this.renderer=null;for(var a=this.list.length-1;a>=0;a--)this.list[a].kill(),this.list.splice(a,1);this.list=[],this.pool=[],this.batch=[],this.wells=[]}},Object.defineProperty(Phaser.ParticleStorm.Emitter.prototype,"paused",{get:function(){return!this.enabled},set:function(a){this.enabled=!a}}),Object.defineProperty(Phaser.ParticleStorm.Emitter.prototype,"total",{get:function(){return this.alive+this.dead}}),Object.defineProperty(Phaser.ParticleStorm.Emitter.prototype,"alive",{get:function(){return this.list.length}}),Object.defineProperty(Phaser.ParticleStorm.Emitter.prototype,"dead",{get:function(){return this.pool.length}}),Phaser.ParticleStorm.Emitter.prototype.constructor=Phaser.ParticleStorm.Emitter,Phaser.ParticleStorm.Particle=function(a){this.emitter=a,this.renderer=null,this.graph=Phaser.ParticleStorm.Graph,this.transform=new Phaser.ParticleStorm.Controls.Transform(this),this.color=new Phaser.ParticleStorm.Controls.Color(this),this.texture=new Phaser.ParticleStorm.Controls.Texture(this),this.parent=null,this.lifespan=2e3,this.keepAlive=!1,this.delay=0,this.delayVisible=!1,this.life=0,this.sprite=null,this.visible=!1,this.isComplete=!1,this.ignoreForce=!1,this.ignoreScrollSpeed=!1,this.emit={},this._age=0,this._lastPercent=0,this._numToEmit=0},Phaser.ParticleStorm.Particle.prototype={reset:function(a,b,c,d){return this.renderer=a,this.transform.reset(),this.color.reset(),this.texture.reset(),this.emit=Object.create(Phaser.ParticleStorm.BASE_EMIT),this.isComplete=!1,this.keepAlive=!1,this.delay=0,this.delayVisible=!1,this.ignoreForce=!1,this.ignoreScrollSpeed=!1,this.alive=!1,this.lifespan=2e3,this.life=0,this.visible=!1,this._age=0,this._lastPercent=0,this._numToEmit=0,void 0!==d&&this.create(b,c,d),this},create:function(a,b,c){if(c.hasOwnProperty("lifespan")&&(this.lifespan=this.graph.getMinMax(c.lifespan)),this.keepAlive=c.keepAlive,c.hasOwnProperty("delay")&&(this.delay=this.graph.getMinMax(c.delay)),this.ignoreForce=c.ignoreForce,this.ignoreScrollSpeed=c.ignoreScrollSpeed,this.transform.init(a,b,c),this.color.init(c),this.texture.init(c),c.emit&&(this.emit=Object.create(c.emit)),this.visible=c.visible===!1?!1:!0,this.alive=!0,this.parent&&this.parent.emit&&this.parent.emit.inherit&&(this.alive=this.onInherit(this.parent)),this.alive){this.transform.step(),this.color.step();var d=this.renderer.add(this);d&&this.texture.step(c,d),this.onEmit(),this.emitter.onEmit&&this.emitter.onEmit.dispatch(this.emitter,this),this.renderer.update(this)}return this},step:function(a,b){if(this._age+=a,this.delay){if(this._age<this.delay)return this.renderer.update(this),!0;this.delay=0,this._age=0}if(this._lastPercent=this.life,this.lifespan>0&&(this.life=Math.min(this._age/this.lifespan,1)),b&&!this.ignoreForce&&(this.transform.velocity.x.value+=b.x,this.transform.velocity.y.value+=b.y),this.transform.step(),this.color.step(),this.onUpdate(),this.alive){for(this._numToEmit+=this.emitter.updateFrequency(this.emit,a,this._lastPercent,this.life);this._numToEmit>=1;)this.emitChild();this.renderer.update(this)}return this.isComplete||1!==this.life||(this.isComplete=!0,this.emitter.onComplete&&this.emitter.onComplete.dispatch(this.emitter,this)),this.life<1||this.keepAlive},emitChild:function(){var a=0|this.graph.getMinMax(this.emit.offsetX),b=0|this.graph.getMinMax(this.emit.offsetY);if(this.emit.rect){var c=this.emit.rect;a=Math.random()*c.width+c.x,b=Math.random()*c.height+c.y}else if(this.emit.circle){var d=this.emit.circle;b=Math.random()*d*2-d;var e=Math.sqrt(d*d-b*b);a=Math.random()*e*2-e}var f=this.emit.name;if("string"!=typeof f&&(f=this.getChildKey(this.emit.name)),f){var g=this.emitter.emitParticle(f,this.transform.x+a,this.transform.y+b,this);g&&this.emit.overwrite&&this.applyOverwrite(this.emit.overwrite,g)}this._numToEmit-=1},applyOverwrite:function(a,b){return b},getChildKey:function(a){if(Array.isArray(a))return this.emitter.game.rnd.pick(a);if(void 0!==a.at&&a.at.length>0){for(var b=a.at[0].value,c=0;c<a.at.length&&!(a.at[c].time>this.life);c++)b=a.at[c].value;return b}return null},radiate:function(a,b,c){void 0===c&&void 0!==b?c=b:(void 0===b&&(b=0),void 0===c&&(c=359));var d=a;a.hasOwnProperty("min")?d=this.graph.getMinMax(a):Array.isArray(a)&&(d=parseFloat(this.emitter.game.rnd.pick(a),10));var e=(Math.random()*(c-b)+b)*Math.PI/180;return this.transform.velocity.x.value=Math.sin(e)*d,this.transform.velocity.y.value=-Math.cos(e)*d,this},radiateFrom:function(a,b,c){var d=c;c.hasOwnProperty("min")?d=this.graph.getMinMax(c):Array.isArray(c)&&(d=parseFloat(this.emitter.game.rnd.pick(c),10));var e=this.transform.x-a,f=this.transform.y-b,g=Math.sqrt(e*e+f*f);return this.transform.velocity.x.value=e*d/g,this.transform.velocity.y.value=f*d/g,this},target:function(a){var b=0,c=0,d=this.transform;if(a.x&&(b=a.x),a.y&&(c=a.y),a.zone){var e=a.zone.getRandom();b+=e.x,c+=e.y}var f=Math.atan2(c-d.y,b-d.x),g=d.x-b,h=d.y-c,i=Math.sqrt(g*g+h*h)/(this.lifespan/1e3),j=Math.cos(f)*i*d.time.physicsElapsed,k=Math.sin(f)*i*d.time.physicsElapsed;return a.speed?(this.graph.fromControl({value:2*j,control:a.speed},d.velocity.x),this.graph.fromControl({value:2*k,control:a.speed},d.velocity.y)):(d.velocity.x.value=j,d.velocity.y.value=k),this},setLife:function(a,b){return this.lifespan=this.graph.getMinMax(a),this.life=0,this._age=0,this._lastPercent=0,this.isComplete=!1,this.keepAlive=b,this},kill:function(){this.alive=!1,this.renderer.kill(this),this.onKill()},onEmit:function(){},onUpdate:function(){},onInherit:function(){return!0},onKill:function(){}},Object.defineProperty(Phaser.ParticleStorm.Particle.prototype,"lifePercent",{get:function(){return Math.round(100*this.life)}}),Object.defineProperty(Phaser.ParticleStorm.Particle.prototype,"frequency",{get:function(){return this.emit.value},set:function(a){this.emit.value=a}}),Phaser.ParticleStorm.Particle.prototype.constructor=Phaser.ParticleStorm.Particle,Phaser.ParticleStorm.GravityWell=function(a,b,c,d,e,f){void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=0),void 0===e&&(e=100),void 0===f&&(f=50),this.emitter=a,this.time=a.game.time,this.position=new Phaser.Point(b,c),this.active=!0,this._gravity=f,this._power=0,this._epsilon=0,this.power=d,this.epsilon=e},Phaser.ParticleStorm.GravityWell.prototype={step:function(a){var b=this.position.x-a.transform.x,c=this.position.y-a.transform.y,d=b*b+c*c;if(0!==d){var e=Math.sqrt(d);d<this._epsilon&&(d=this._epsilon);var f=this._power*this.time.elapsed/(d*e);a.transform.velocity.x.value+=b*f,a.transform.velocity.y.value+=c*f}}},Object.defineProperty(Phaser.ParticleStorm.GravityWell.prototype,"epsilon",{get:function(){return Math.sqrt(this._epsilon)},set:function(a){this._epsilon=a*a}}),Object.defineProperty(Phaser.ParticleStorm.GravityWell.prototype,"power",{get:function(){return this._power/this.gravity},set:function(a){this._power=a*this.gravity}}),Object.defineProperty(Phaser.ParticleStorm.GravityWell.prototype,"gravity",{get:function(){return this._gravity},set:function(a){var b=this.power;this._gravity=a,this.power=b}}),Phaser.ParticleStorm.GravityWell.prototype.constructor=Phaser.ParticleStorm.GravityWell,Phaser.ParticleStorm.Graph={CONTROL_LINEAR:[{x:0,y:1},{x:1,y:0}],CONTROL_REVERSE:[{x:0,y:0},{x:1,y:1}],CONTROL_YOYO:[{x:0,y:0},{x:.5,y:1},{x:1,y:0}],getControlValue:function(a,b){var c=0,d=a[c];if(d.x===b)return d.y;for(;d.x<=b;){if(c>=a.length-1)return d.x;d=a[++c]}var e=a[c-1];return e.y+(b-e.x)*(d.y-e.y)/(d.x-e.x)},getControlValues:function(a,b,c){var d=Phaser.ParticleStorm.Graph.getControlValue(a,b),e=[{x:b,y:d}];if(b>=c)return e;for(var f=0;f<a.length;f++)if(a[f].x>b){if(!(a[f].x<c))break;e.push(a[f])}return e.push({x:c,y:Phaser.ParticleStorm.Graph.getControlValue(a,c)}),e},getParamArea:function(a,b,c){return a.control?a.value*Phaser.ParticleStorm.Graph.getControlArea(a.control,b,c):a.value},getControlArea:function(a,b,c){var d=Phaser.ParticleStorm.Graph.getControlValues(a,b,c);if(b>=c)return d[0].y;for(var e=d.length>1?0:d.y,f=d[0],g=1;g<d.length;g++){var h=d[g];e+=.5*(h.x-f.x)*(f.y+h.y),f=h}return e},getMinMaxInitial:function(a){return void 0!==a.initial?Phaser.ParticleStorm.Graph.getMinMax(a.initial):0},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},getMinMax:function(a){return void 0!==a&&null!==a&&void 0!==a.min&&void 0!==a.max?a.min+Math.random()*(a.max-a.min):a},clone:function(a,b){return b.value=a.value,b.initial=a.initial,b.delta=a.delta,b.offset=a.offset,b.min=a.min,b.max=a.max,b.control=a.control,b},fromControl:function(a,b){void 0!==a.value&&(b.value=Phaser.ParticleStorm.Graph.getMinMax(a.value)),a.control&&("linear"===a.control?b.control=Phaser.ParticleStorm.Graph.CONTROL_LINEAR:"reverse"===a.control?b.control=Phaser.ParticleStorm.Graph.CONTROL_REVERSE:"yoyo"===a.control?b.control=Phaser.ParticleStorm.Graph.CONTROL_YOYO:b.control=a.control)},fromData:function(a,b){return void 0===a||null===a?!1:"number"==typeof a?(b.value=a,!0):(void 0!==a.min?b.value=Phaser.ParticleStorm.Graph.getMinMax(a):void 0!==a.value&&(b.value=Phaser.ParticleStorm.Graph.getMinMax(a.value)),void 0!==a.initial&&(b.initial=Phaser.ParticleStorm.Graph.getMinMax(a.initial)),void 0!==a.delta&&(b.delta=Phaser.ParticleStorm.Graph.getMinMax(a.delta)),void 0!==a.offset&&(b.offset=Phaser.ParticleStorm.Graph.getMinMax(a.offset)),a.control&&("linear"===a.control?b.control=Phaser.ParticleStorm.Graph.CONTROL_LINEAR:"reverse"===a.control?b.control=Phaser.ParticleStorm.Graph.CONTROL_REVERSE:"yoyo"===a.control?b.control=Phaser.ParticleStorm.Graph.CONTROL_YOYO:b.control=a.control),!0)},getValue:function(a,b){if(!a.control||void 0===b)return a.value;var c=a.control[0];if(c.x===b)return c.y;var d=a.control.length-1,e=a.control[d];if(e.x===b)return e.y;for(d=0;c.x<=b;){if(d>=a.control.length-1)return c.y;c=a.control[++d]}var f=a.control[d-1];return a.value*(f.y+(b-f.x)*(c.y-f.y)/(c.x-f.x))},getClampedValue:function(a,b){return Phaser.Math.clamp(Math.floor(a.initial+this.getValue(a,b)),a.min,a.max)}},Phaser.ParticleStorm.Zones={},Phaser.ParticleStorm.Zones.Base=function(a){this.game=a,this.active=!0,this.scale=new Phaser.Point(1,1),this.alphaThreshold=0,this._rnd=new Phaser.Point},Phaser.ParticleStorm.Zones.Base.prototype={getRandom:function(){return this.shape===Phaser.Point?this._rnd=this.shape:this.shape.random(this._rnd),this._rnd.x*=this.scale.x,this._rnd.y*=this.scale.y,this._rnd},emit:function(a,b,c,d,e){Array.isArray(c)&&(c=this.game.rnd.between(c[0],c[1])),Array.isArray(d)&&(d=this.game.rnd.between(d[0],d[1]));for(var f=null,g=0;e>g;g++)this.shape.random(this._rnd),f=a.emitParticle(b,c+this._rnd.x*this.scale.x,d+this._rnd.y*this.scale.y,null);return f}},Phaser.ParticleStorm.Zones.Base.prototype.constructor=Phaser.ParticleStorm.Zones.Base,Phaser.ParticleStorm.Zones.Point=function(a,b,c){Phaser.ParticleStorm.Zones.Base.call(this,a),this.shape=new Phaser.Point(b,c)},Phaser.ParticleStorm.Zones.Point.prototype=Object.create(Phaser.ParticleStorm.Zones.Base.prototype),Phaser.ParticleStorm.Zones.Point.prototype.constructor=Phaser.ParticleStorm.Zones.Point,Phaser.ParticleStorm.Zones.Rectangle=function(a,b,c){Phaser.ParticleStorm.Zones.Base.call(this,a),this.shape=new Phaser.Rectangle(0,0,b,c)},Phaser.ParticleStorm.Zones.Rectangle.prototype=Object.create(Phaser.ParticleStorm.Zones.Base.prototype),Phaser.ParticleStorm.Zones.Rectangle.prototype.constructor=Phaser.ParticleStorm.Zones.Rectangle,Phaser.ParticleStorm.Zones.Circle=function(a,b){Phaser.ParticleStorm.Zones.Base.call(this,a),this.shape=new Phaser.Circle(0,0,2*b)},Phaser.ParticleStorm.Zones.Circle.prototype=Object.create(Phaser.ParticleStorm.Zones.Base.prototype),Phaser.ParticleStorm.Zones.Circle.prototype.constructor=Phaser.ParticleStorm.Zones.Circle,Phaser.ParticleStorm.Zones.Ellipse=function(a,b,c){Phaser.ParticleStorm.Zones.Base.call(this,a),this.shape=new Phaser.Ellipse(0,0,b,c)},Phaser.ParticleStorm.Zones.Ellipse.prototype=Object.create(Phaser.ParticleStorm.Zones.Base.prototype),Phaser.ParticleStorm.Zones.Ellipse.prototype.constructor=Phaser.ParticleStorm.Zones.Ellipse,Phaser.ParticleStorm.Zones.Line=function(a,b,c,d,e){Phaser.ParticleStorm.Zones.Base.call(this,a),this.shape=new Phaser.Line(b,c,d,e)},Phaser.ParticleStorm.Zones.Line.prototype=Object.create(Phaser.ParticleStorm.Zones.Base.prototype),Phaser.ParticleStorm.Zones.Line.prototype.constructor=Phaser.ParticleStorm.Zones.Line,Phaser.ParticleStorm.Zones.Spline=function(a,b,c,d,e){void 0===b&&(b=0),void 0===c&&(c=1e3),void 0===d&&(d=!0),Phaser.ParticleStorm.Zones.Base.call(this,a),this.math=this.game.math,this.points={x:[],y:[]},this.path=[],this.resolution=c,this.mode=b,this.closed=d,this.mult=0,this.update(e)},Phaser.ParticleStorm.Zones.Spline.prototype=Object.create(Phaser.ParticleStorm.Zones.Base.prototype),Phaser.ParticleStorm.Zones.Spline.prototype.constructor=Phaser.ParticleStorm.Zones.Spline,Phaser.ParticleStorm.Zones.Spline.prototype.update=function(a){this.points={x:[],y:[]},this.path=[];for(var b=0;b<a.length;b++)this.points.x.push(a[b].x),this.points.y.push(a[b].y);this.closed&&(this.points.x.push(a[0].x),this.points.y.push(a[0].y));for(var c=0,d=1/this.resolution,b=0;1>=b;b+=d){if(0===this.mode)var e=this.math.linearInterpolation(this.points.x,b),f=this.math.linearInterpolation(this.points.y,b);else if(1===this.mode)var e=this.math.bezierInterpolation(this.points.x,b),f=this.math.bezierInterpolation(this.points.y,b);else if(2===this.mode)var e=this.math.catmullRomInterpolation(this.points.x,b),f=this.math.catmullRomInterpolation(this.points.y,b);var g={x:e,y:f,angle:0};c>0&&(g.angle=this.math.angleBetweenPoints(this.path[c-1],g)),this.path.push(g),c++}return this.mult=this.path.length/100,this},Phaser.ParticleStorm.Zones.Spline.prototype.getRandom=function(){return this.game.rnd.pick(this.path)},Phaser.ParticleStorm.Zones.Spline.prototype.emit=function(a,b,c,d,e){Array.isArray(c)&&(c=this.game.rnd.between(c[0],c[1])),Array.isArray(d)&&(d=this.game.rnd.between(d[0],d[1]));for(var f=null,g=null,h=0;e>h;h++)f=this.game.rnd.pick(this.path),g=a.emitParticle(b,c+f.x,d+f.y);return g},Phaser.ParticleStorm.Zones.Spline.prototype.emitPercent=function(a,b,c,d,e,f){Array.isArray(c)&&(c=this.game.rnd.between(c[0],c[1])),Array.isArray(d)&&(d=this.game.rnd.between(d[0],d[1]));var g=null;f=Math.floor(f*this.mult);for(var h=0;e>h;h++){var i=this.path[f];i&&(g=a.emitParticle(b,c+i.x,d+i.y))}return g},Phaser.ParticleStorm.Zones.Text=function(a,b){Phaser.ParticleStorm.Zones.Base.call(this,a),this.bmd=new Phaser.BitmapData(a,"ParticleStorm.Text"),this.text=b,this.points=[],this.update(b)},Phaser.ParticleStorm.Zones.Text.prototype=Object.create(Phaser.ParticleStorm.Zones.Base.prototype),Phaser.ParticleStorm.Zones.Text.prototype.constructor=Phaser.ParticleStorm.Zones.Text,Phaser.ParticleStorm.Zones.Text.prototype.update=function(a){void 0!==a?this.text=a:a=this.text;var b=a.x,c=a.y,d=a.scale.x,e=a.scale.y;return a.x=0,a.y=0,a.scale.set(1),this.points=[],this.bmd.load(a),this.bmd.processPixelRGB(this.addPixel,this),this.scale=new Phaser.Point(d,e),a.x=b,a.y=c,a.scale.set(d,e),this},Phaser.ParticleStorm.Zones.Text.prototype.addPixel=function(a,b,c){return a.a>this.alphaThreshold&&this.points.push({x:b,y:c,color:{r:a.r,g:a.g,b:a.b,a:a.a/255}}),!1},Phaser.ParticleStorm.Zones.Text.prototype.getRandom=function(){var a=this.game.rnd.pick(this.points);return a.x*=this.scale.x,a.y*=this.scale.y,a},Phaser.ParticleStorm.Zones.Text.prototype.emit=function(a,b,c,d,e,f,g){Array.isArray(c)&&(c=this.game.rnd.between(c[0],c[1])),Array.isArray(d)&&(d=this.game.rnd.between(d[0],d[1]));for(var h=null,i=null,j=0;e>j;j++)h=this.game.rnd.pick(this.points),i=a.emitParticle(b,c+h.x*this.scale.x,d+h.y*this.scale.y),i&&(f&&h.color.a<1&&(i.color.alpha.value=h.color.a),g&&i.color.setColor(h.color.r,h.color.g,h.color.b,h.color.a));return i},Phaser.ParticleStorm.Zones.Text.prototype.emitFull=function(a,b,c,d,e,f,g,h){void 0===e&&(e=1);var i=1,j=1;Array.isArray(f)?(i=f[0],j=f[1]):"number"==typeof f&&(i=f,j=f),Array.isArray(c)&&(c=this.game.rnd.between(c[0],c[1])),Array.isArray(d)&&(d=this.game.rnd.between(d[0],d[1]));for(var k=null,l=null,m=0;m<this.points.length;m+=e){k=this.points[m];var n=c+k.x*this.scale.x*(i/e),o=d+k.y*this.scale.y*(j/e);l=a.emitParticle(b,n,o),l&&(g&&k.color.a<1&&(l.color.alpha.value=k.color.a),h&&l.color.setColor(k.color.r,k.color.g,k.color.b,k.color.a))}return l},Phaser.ParticleStorm.Zones.Image=function(a,b){Phaser.ParticleStorm.Zones.Base.call(this,a),this.bmd=new Phaser.BitmapData(a,"ParticleStorm.Image"),this.key=b,this.points=[],this.update(b)},Phaser.ParticleStorm.Zones.Image.prototype=Object.create(Phaser.ParticleStorm.Zones.Base.prototype),Phaser.ParticleStorm.Zones.Image.prototype.constructor=Phaser.ParticleStorm.Zones.Image,Phaser.ParticleStorm.Zones.Image.prototype.update=function(a){return void 0===a&&(a=this.key),this.points=[],this.bmd.load(a),this.bmd.processPixelRGB(this.addPixel,this),this},Phaser.ParticleStorm.Zones.Image.prototype.addPixel=function(a,b,c){return a.a>this.alphaThreshold&&this.points.push({x:b,y:c,color:{r:a.r,g:a.g,b:a.b,a:a.a/255}}),!1},Phaser.ParticleStorm.Zones.Image.prototype.getRandom=function(){var a=this.game.rnd.pick(this.points);return a.x*=this.scale.x,a.y*=this.scale.y,a},Phaser.ParticleStorm.Zones.Image.prototype.emit=function(a,b,c,d,e,f,g){Array.isArray(c)&&(c=this.game.rnd.between(c[0],c[1])),Array.isArray(d)&&(d=this.game.rnd.between(d[0],d[1]));for(var h=null,i=null,j=0;e>j;j++)h=this.game.rnd.pick(this.points),i=a.emitParticle(b,c+h.x*this.scale.x,d+h.y*this.scale.y),i&&(f&&h.color.a<1&&(i.color.alpha.value=h.color.a),g&&i.color.setColor(h.color.r,h.color.g,h.color.b,h.color.a));return i},Phaser.ParticleStorm.Zones.Image.prototype.emitFull=function(a,b,c,d,e,f,g,h){void 0===e&&(e=1);var i=1,j=1;Array.isArray(f)?(i=f[0],j=f[1]):"number"==typeof f&&(i=f,j=f),Array.isArray(c)&&(c=this.game.rnd.between(c[0],c[1])),Array.isArray(d)&&(d=this.game.rnd.between(d[0],d[1]));for(var k=null,l=null,m=0;m<this.points.length;m+=e){k=this.points[m];var n=c+k.x*this.scale.x*(i/e),o=d+k.y*this.scale.y*(j/e);l=a.emitParticle(b,n,o),l&&(g&&k.color.a<1&&(l.color.alpha.value=k.color.a),h&&l.color.setColor(k.color.r,k.color.g,k.color.b,k.color.a))}return l},Phaser.ParticleStorm.Controls.Texture=function(a){this.particle=a,this.rnd=a.emitter.game.rnd,this.graph=Phaser.ParticleStorm.Graph,this.sendToBack=!1,this.bringToTop=!0,this.key=null,this.frame=void 0,this.frameName=void 0,this.scaleMode=Phaser.scaleModes.DEFAULT},Phaser.ParticleStorm.Controls.Texture.prototype={reset:function(){this.sendToBack=!1,this.bringToTop=!0,this.key="__default",this.frame=void 0,this.frameName=void 0,this.scaleMode=Phaser.scaleModes.DEFAULT},init:function(a){if(a.sendToBack?this.sendToBack=a.sendToBack:a.bringToTop&&(this.bringToTop=a.bringToTop),a.image&&(Array.isArray(a.image)?this.key=this.rnd.pick(a.image):this.key=a.image),void 0!==a.frame){var b=a.frame;Array.isArray(a.frame)&&(b=this.rnd.pick(a.frame)),this.graph.isNumeric(b)?this.frame=b:this.frameName=b}if(a.scaleMode){var c=a.scaleMode.toUpperCase();"LINEAR"===c?this.scaleMode=Phaser.scaleModes.LINEAR:"NEAREST"===c&&(this.scaleMode=Phaser.scaleModes.NEAREST)}},step:function(a,b){if(this.particle.emitter.renderType===Phaser.ParticleStorm.SPRITE&&void 0!==a.animations){var c=[];for(var d in a.animations){var e=a.animations[d],f=null,g=!0;void 0!==e.frames&&(f=Array.isArray(e.frames)?e.frames:Phaser.Animation.generateFrameNames(e.frames.prefix,e.frames.start,e.frames.stop,e.frames.suffix,e.frames.zeroPad),"string"==typeof f[0]&&(g=!1));var h=void 0===e.frameRate?60:e.frameRate,i=void 0===e.loop?!1:e.loop;b.animations.add(d,f,h,i,g),c.push(d)}c.length>0&&(void 0!==a.play?b.play(this.rnd.pick(c)):b.play(c[0]))}this.sendToBack?b.sendToBack():this.bringToTop&&b.bringToTop()}},Phaser.ParticleStorm.Controls.Texture.prototype.constructor=Phaser.ParticleStorm.Controls.Texture,Phaser.ParticleStorm.Controls.Color=function(a){this.particle=a,this.graph=Phaser.ParticleStorm.Graph,this.red={},this.green={},this.blue={},this.alpha={},this.hsv={},this.hsvData=this.particle.emitter.parent.hsv,this.tint=0,this.isTinted=!1,this.rgba="rgba(0, 0, 0, 1)",this.blendMode=this.particle.emitter.parent.blendModeMap.NORMAL},Phaser.ParticleStorm.Controls.Color.prototype={reset:function(){this.red=Object.create(Phaser.ParticleStorm.BASE_255),this.green=Object.create(Phaser.ParticleStorm.BASE_255),this.blue=Object.create(Phaser.ParticleStorm.BASE_255),this.alpha=Object.create(Phaser.ParticleStorm.BASE_1),this.tint=16777215,this.isTinted=!1,this.isHSV=!1,this.hsv=Object.create(Phaser.ParticleStorm.BASE_359),this.rgba="rgba(0, 0, 0, 1)",this.blendMode=this.particle.emitter.parent.blendModeMap.NORMAL},init:function(a){var b=!1;a.hasOwnProperty("hsv")?("number"==typeof a.hsv?this.hsv.value=a.hsv:this.graph.fromData(a.hsv,this.hsv),b=!0,this.isHSV=!0):(a.hasOwnProperty("red")&&("number"==typeof a.red?this.red.value=a.red:this.graph.fromData(a.red,this.red),b=!0),a.hasOwnProperty("green")&&("number"==typeof a.green?this.green.value=a.green:this.graph.fromData(a.green,this.green),b=!0),a.hasOwnProperty("blue")&&("number"==typeof a.blue?this.blue.value=a.blue:this.graph.fromData(a.blue,this.blue),b=!0)),a.hasOwnProperty("alpha")&&("number"==typeof a.alpha?this.alpha.value=a.alpha:this.graph.fromData(a.alpha,this.alpha)),
this.red.value=Phaser.Math.clamp(this.red.value,0,255),this.green.value=Phaser.Math.clamp(this.green.value,0,255),this.blue.value=Phaser.Math.clamp(this.blue.value,0,255),this.alpha.value=Phaser.Math.clamp(this.alpha.value,0,1),this.hsv.value=Phaser.Math.clamp(this.hsv.value,0,359),this.particle.emitter.renderType!==Phaser.ParticleStorm.PIXEL&&(this.isTinted=b),a.blendMode&&(this.blendMode=this.particle.emitter.parent.blendModeMap[a.blendMode.toUpperCase()])},step:function(){var a=this.particle.life;this.isHSV?(this.hsv.value+=this.hsv.delta,this.hsv.calc=Phaser.Math.clamp(Math.floor(this.hsv.initial+this.graph.getValue(this.hsv,a)),0,359),this.red.value=this.hsvData[this.hsv.calc].r,this.green.value=this.hsvData[this.hsv.calc].g,this.blue.value=this.hsvData[this.hsv.calc].b):(this.red.value+=this.red.delta,this.green.value+=this.green.delta,this.blue.value+=this.blue.delta),this.red.calc=this.graph.getClampedValue(this.red,a),this.green.calc=this.graph.getClampedValue(this.green,a),this.blue.calc=this.graph.getClampedValue(this.blue,a),this.isTinted&&(this.tint=this.red.calc<<16|this.green.calc<<8|this.blue.calc),this.alpha.value+=this.alpha.delta,this.alpha.calc=Phaser.Math.clamp(this.alpha.initial+this.graph.getValue(this.alpha,a),0,1),this.rgba="rgba("+this.red.calc+","+this.green.calc+","+this.blue.calc+","+this.alpha.calc+")"},setColor:function(a,b,c,d){this.red.value=a,this.green.value=b,this.blue.value=c,this.alpha.value=d,this.particle.emitter.renderType!==Phaser.ParticleStorm.PIXEL&&(this.isTinted=!0),this.step()}},Phaser.ParticleStorm.Controls.Color.prototype.constructor=Phaser.ParticleStorm.Controls.Color,Phaser.ParticleStorm.Controls.Transform=function(a){this.particle=a,this.time=a.emitter.game.time,this.graph=Phaser.ParticleStorm.Graph,this.x=0,this.y=0,this.velocity={x:null,y:null,facing:null},this.acceleration={x:null,y:null,facing:null},this.scale={x:null,y:null},this.rotation={},this.anchor=new Phaser.Point},Phaser.ParticleStorm.Controls.Transform.prototype={reset:function(){this.velocity.x=Object.create(Phaser.ParticleStorm.BASE),this.velocity.y=Object.create(Phaser.ParticleStorm.BASE),this.velocity.facing=Object.create(Phaser.ParticleStorm.BASE_NULL),this.acceleration.x=Object.create(Phaser.ParticleStorm.BASE),this.acceleration.y=Object.create(Phaser.ParticleStorm.BASE),this.acceleration.facing=Object.create(Phaser.ParticleStorm.BASE_NULL),this.scale.x=Object.create(Phaser.ParticleStorm.BASE_1),this.scale.y=Object.create(Phaser.ParticleStorm.BASE_1),this.rotation=Object.create(Phaser.ParticleStorm.BASE),this.anchor.set(.5)},init:function(a,b,c){if(this.x=a,this.y=b,c.hasOwnProperty("anchor")?this.anchor.set(c.anchor):(c.hasOwnProperty("anchorX")&&(this.anchor.x=c.anchorX),c.hasOwnProperty("anchorY")&&(this.anchor.y=c.anchorY)),c.hasOwnProperty("velocity")){if(this.graph.isNumeric(c.velocity))this.velocity.x.value=c.velocity,this.velocity.y.value=c.velocity;else if(c.velocity.hasOwnProperty("min"))this.velocity.x.value=this.graph.getMinMax(c.velocity),this.velocity.y.value=this.velocity.x.value;else if(c.velocity.radial){var d=this.graph.getMinMaxInitial(c.velocity),e=c.velocity.radial.arcStart,f=c.velocity.radial.arcEnd;if(void 0!==e&&void 0!==f){var g=(Math.random()*(f-e)+e)*Math.PI/180,h=Math.sin(g),i=-Math.cos(g);this.velocity.x.value=h*d,this.velocity.y.value=i*d}}else this.velocity.x.initial=this.graph.getMinMaxInitial(c.velocity),this.velocity.y.initial=this.velocity.x.initial,this.velocity.x.value=this.graph.getMinMax(c.velocity.value),this.velocity.y.value=this.velocity.x.value;c.velocity.hasOwnProperty("delta")&&(this.velocity.x.delta=this.graph.getMinMax(c.velocity.delta),this.velocity.y.delta=this.velocity.x.delta),c.velocity.hasOwnProperty("control")&&(this.velocity.x.control=c.velocity.control,this.velocity.y.control=c.velocity.control),c.hasOwnProperty("vx")&&this.graph.fromData(c.vx,this.velocity.x),c.hasOwnProperty("vy")&&this.graph.fromData(c.vy,this.velocity.y)}else c.hasOwnProperty("target")?this.particle.target(c.target):("number"==typeof c.vx?this.velocity.x.value=c.vx:this.graph.fromData(c.vx,this.velocity.x),"number"==typeof c.vy?this.velocity.y.value=c.vy:this.graph.fromData(c.vy,this.velocity.y));"number"==typeof c.facingVelocity?this.velocity.facing.value=c.facingVelocity:this.graph.fromData(c.facingVelocity,this.velocity.facing),"number"==typeof c.facingAcceleration?this.acceleration.facing.value=c.facingAcceleration:this.graph.fromData(c.facingAcceleration,this.acceleration.facing),c.hasOwnProperty("acceleration")?(this.graph.fromData(c.acceleration,this.acceleration.x),this.graph.fromData(c.acceleration,this.acceleration.y)):("number"==typeof c.ax?this.acceleration.x.value=c.ax:this.graph.fromData(c.ax,this.acceleration.x),"number"==typeof c.ay?this.acceleration.y.value=c.ay:this.graph.fromData(c.ay,this.acceleration.y)),c.hasOwnProperty("scale")?(this.graph.fromData(c.scale,this.scale.x),this.graph.clone(this.scale.x,this.scale.y)):("number"==typeof c.scaleX?this.scale.x.value=c.scaleX:this.graph.fromData(c.scaleX,this.scale.x),"number"==typeof c.scaleY?this.scale.y.value=c.scaleY:this.graph.fromData(c.scaleY,this.scale.y)),"number"==typeof c.rotation?this.rotation.value=c.rotation:this.graph.fromData(c.rotation,this.rotation);var j=this.particle.parent;j&&j.emit&&j.emit.inherit&&this.inherit(j)},inherit:function(a){var b=a.emit.inherit,c=!1;if("boolean"==typeof b&&(c=!0),(c||b.vx||b.velocity)&&this.graph.clone(a.transform.velocity.x,this.velocity.x),(c||b.vy||b.velocity)&&this.graph.clone(a.transform.velocity.y,this.velocity.y),(c||b.facingVelocity)&&this.graph.clone(a.transform.velocity.facing,this.velocity.facing),(c||b.scaleX||b.scale)&&this.graph.clone(a.transform.scale.x,this.scale.x),(c||b.scaleY||b.scale)&&this.graph.clone(a.transform.scale.y,this.scale.y),(c||b.rotation)&&this.graph.clone(a.transform.rotation,this.rotation),b.angularVelocity){var d=(a.transform.rotation.initial+a.transform.rotation.value)*Math.PI/180;this.velocity.x.initial=Math.sin(d),this.velocity.y.initial=-Math.cos(d)}},step:function(){var a=this.particle.life;if(this.scale.x.value+=this.scale.x.delta,this.scale.y.value+=this.scale.y.delta,this.rotation.value+=this.rotation.delta,this.rotation.calc=(this.rotation.initial+this.graph.getValue(this.rotation,a))*Math.PI/180,this.scale.x.calc=this.scale.x.initial+this.graph.getValue(this.scale.x,a),this.scale.y.calc=this.scale.y.initial+this.graph.getValue(this.scale.y,a),0!==a){var b=0,c=0;null!==this.acceleration.facing.value&&(this.acceleration.facing.value+=this.acceleration.facing.delta,b=this.rotation.calc+(90+this.acceleration.facing.offset)*Math.PI/180,c=this.acceleration.facing.initial+this.graph.getValue(this.acceleration.facing,a),this.velocity.x.value+=c*Math.sin(b),this.velocity.y.value+=c*-Math.cos(b)),this.acceleration.x.value+=this.acceleration.x.delta,this.acceleration.y.value+=this.acceleration.y.delta,this.velocity.x.value+=this.velocity.x.delta+this.acceleration.x.initial+this.graph.getValue(this.acceleration.x,a),this.velocity.y.value+=this.velocity.y.delta+this.acceleration.y.initial+this.graph.getValue(this.acceleration.y,a),null!==this.velocity.facing.value&&(this.velocity.facing.value+=this.velocity.facing.delta,b=this.rotation.calc+(90+this.velocity.facing.offset)*Math.PI/180,c=this.velocity.facing.initial+this.graph.getValue(this.velocity.facing,a),this.x+=c*Math.sin(b),this.y+=c*-Math.cos(b)),this.x+=this.velocity.x.initial+this.graph.getValue(this.velocity.x,a),this.y+=this.velocity.y.initial+this.graph.getValue(this.velocity.y,a)}}},Phaser.ParticleStorm.Controls.Transform.prototype.constructor=Phaser.ParticleStorm.Controls.Transform,Phaser.ParticleStorm.Renderer={},Phaser.ParticleStorm.Renderer.Base=function(a){this.game=a.game,this.emitter=a,this.parent=a.parent,this.pixelSize=1},Phaser.ParticleStorm.Renderer.Base.prototype={addToWorld:function(a){return a.add(this.display),this.display},preUpdate:function(){},add:function(){return null},update:function(a){return a},postUpdate:function(){},kill:function(a){return a},destroy:function(){this.game=null}},Phaser.ParticleStorm.Renderer.Base.prototype.constructor=Phaser.ParticleStorm.Renderer.Base,Phaser.ParticleStorm.Renderer.Sprite=function(a){Phaser.ParticleStorm.Renderer.Base.call(this,a),this.display=this.game.make.group(null,"particleStormSpriteRenderer")},Phaser.ParticleStorm.Renderer.Sprite.prototype=Object.create(Phaser.ParticleStorm.Renderer.Base.prototype),Phaser.ParticleStorm.Renderer.Sprite.prototype.constructor=Phaser.ParticleStorm.Renderer.Sprite,Phaser.ParticleStorm.Renderer.Sprite.prototype.add=function(a){var b=a.sprite,c=a.texture.key,d=a.texture.frame;return void 0===d&&void 0!==a.texture.frameName&&(d=a.texture.frameName),b?(b.reset(a.transform.x,a.transform.y),b.key!==c?b.loadTexture(c,d):void 0!==a.texture.frame?b.frame=d:void 0!==a.texture.frameName&&(b.frameName=d)):b=this.display.create(a.transform.x,a.transform.y,c,d),b.anchor.set(a.transform.anchor.x,a.transform.anchor.y),a.color.isTinted&&(b.tint=a.color.tint),b.blendMode=a.color.blendMode[0],b.texture.baseTexture.scaleMode=a.texture.scaleMode,b.visible=a.visible,a.sprite=b,b},Phaser.ParticleStorm.Renderer.Sprite.prototype.update=function(a){var b=a.sprite;return a.delay>0&&!a.delayVisible?void(b.visible=!1):(b.visible=a.visible,b.alpha=a.color.alpha.calc,b.rotation=a.transform.rotation.calc,a.color.isTinted&&(b.tint=a.color.tint),b.scale.setTo(a.transform.scale.x.calc,a.transform.scale.y.calc),b.x=a.transform.x,void(b.y=a.transform.y))},Phaser.ParticleStorm.Renderer.Sprite.prototype.kill=function(a){a.sprite&&a.sprite.kill()},Phaser.ParticleStorm.Renderer.Sprite.prototype.destroy=function(){this.display.destroy(!0),this.emitter=null,this.game=null},Phaser.ParticleStorm.Renderer.Pixel=function(a,b,c){Phaser.ParticleStorm.Renderer.Base.call(this,a),this.bmd=this.game.make.bitmapData(b,c),this.display=this.game.make.image(0,0,this.bmd),this.autoClear=!0},Phaser.ParticleStorm.Renderer.Pixel.prototype=Object.create(Phaser.ParticleStorm.Renderer.Base.prototype),Phaser.ParticleStorm.Renderer.Pixel.prototype.constructor=Phaser.ParticleStorm.Renderer.Pixel,Phaser.ParticleStorm.Renderer.Pixel.prototype.resize=function(a,b){return this.bmd.resize(a,b),this},Phaser.ParticleStorm.Renderer.Pixel.prototype.clear=function(a){return this.bmd.fill(0,0,0,a),this.bmd.update(),this},Phaser.ParticleStorm.Renderer.Pixel.prototype.preUpdate=function(){this.autoClear&&(this.bmd.clear(),this.bmd.update())},Phaser.ParticleStorm.Renderer.Pixel.prototype.update=function(a){if(!(a.delay>0)||a.delayVisible){var b=Math.floor(a.transform.x),c=Math.floor(a.transform.y),d=a.color.red.calc,e=a.color.green.calc,f=a.color.blue.calc,g=Math.floor(255*a.color.alpha.calc);this.pixelSize>2?this.bmd.rect(b,c,this.pixelSize,this.pixelSize,a.color.rgba):(this.bmd.setPixel32(b,c,d,e,f,g,!1),2===this.pixelSize&&(this.bmd.setPixel32(b+1,c,d,e,f,g,!1),this.bmd.setPixel32(b,c+1,d,e,f,g,!1),this.bmd.setPixel32(b+1,c+1,d,e,f,g,!1)))}},Phaser.ParticleStorm.Renderer.Pixel.prototype.postUpdate=function(){this.pixelSize<=2&&this.bmd.context.putImageData(this.bmd.imageData,0,0),this.bmd.dirty=!0},Phaser.ParticleStorm.Renderer.Pixel.prototype.destroy=function(){this.game=null,this.display.destroy(),this.bmd.destroy()},Phaser.ParticleStorm.Renderer.BitmapData=function(a,b,c){Phaser.ParticleStorm.Renderer.Base.call(this,a),this.bmd=this.game.make.bitmapData(b,c),this.display=this.game.make.image(0,0,this.bmd),this.roundPx=!0,this.autoClear=!0},Phaser.ParticleStorm.Renderer.BitmapData.prototype=Object.create(Phaser.ParticleStorm.Renderer.Base.prototype),Phaser.ParticleStorm.Renderer.BitmapData.prototype.constructor=Phaser.ParticleStorm.Renderer.BitmapData,Phaser.ParticleStorm.Renderer.BitmapData.prototype.resize=function(a,b){return this.bmd.resize(a,b),this},Phaser.ParticleStorm.Renderer.BitmapData.prototype.clear=function(a){return this.bmd.fill(0,0,0,a),this},Phaser.ParticleStorm.Renderer.BitmapData.prototype.preUpdate=function(){this.autoClear&&this.bmd.clear()},Phaser.ParticleStorm.Renderer.BitmapData.prototype.update=function(a){if(!(a.delay>0)||a.delayVisible){var b=a.transform;this.bmd.copy(a.texture.key,0,0,null,null,b.x,b.y,null,null,b.rotation.calc,b.anchor.x,b.anchor.y,b.scale.x.calc,b.scale.y.calc,a.color.alpha.calc,a.color.blendMode[1],this.roundPx)}},Phaser.ParticleStorm.Renderer.BitmapData.prototype.destroy=function(){this.game=null,this.display.destroy(),this.bmd.destroy()},Phaser.ParticleStorm.Renderer.RenderTexture=function(a,b,c){Phaser.ParticleStorm.Renderer.Base.call(this,a),this.renderTexture=this.game.make.renderTexture(b,c),this.display=this.game.make.image(0,0,this.renderTexture),this.stamp=this.game.make.image(0,0),this.autoClear=!0},Phaser.ParticleStorm.Renderer.RenderTexture.prototype=Object.create(Phaser.ParticleStorm.Renderer.Base.prototype),Phaser.ParticleStorm.Renderer.RenderTexture.prototype.constructor=Phaser.ParticleStorm.Renderer.RenderTexture,Phaser.ParticleStorm.Renderer.RenderTexture.prototype.clear=function(){this.renderTexture.clear()},Phaser.ParticleStorm.Renderer.RenderTexture.prototype.preUpdate=function(){this.autoClear&&this.renderTexture.clear()},Phaser.ParticleStorm.Renderer.RenderTexture.prototype.update=function(a){if(!(a.delay>0&&!a.delayVisible||!a.visible||0===a.color.alpha.calc)){var b=a.texture.key,c=a.texture.frame;void 0===c&&void 0!==a.texture.frameName&&(c=a.texture.frameName),this.stamp.key!==b?this.stamp.loadTexture(b,c):void 0!==a.texture.frame?this.stamp.frame=c:void 0!==a.texture.frameName&&(this.stamp.frameName=c),this.stamp.anchor.set(a.transform.anchor.x,a.transform.anchor.y),this.stamp.alpha=a.color.alpha.calc,this.stamp.rotation=a.transform.rotation.calc,a.color.isTinted&&(this.stamp.tint=a.color.tint),this.stamp.blendMode=a.color.blendMode[0],this.stamp.texture.baseTexture.scaleMode=a.texture.scaleMode,this.stamp.scale.setTo(a.transform.scale.x.calc,a.transform.scale.y.calc),this.renderTexture.renderXY(this.stamp,a.transform.x,a.transform.y,!1)}},Phaser.ParticleStorm.Renderer.RenderTexture.prototype.destroy=function(){this.display.destroy(),this.stamp.destroy(),this.renderTexture.destroy(),this.emitter=null,this.game=null},Phaser.ParticleStorm.Renderer.SpriteBatch=function(a){Phaser.ParticleStorm.Renderer.Base.call(this,a),this.display=this.game.make.spriteBatch()},Phaser.ParticleStorm.Renderer.SpriteBatch.prototype=Object.create(Phaser.ParticleStorm.Renderer.Base.prototype),Phaser.ParticleStorm.Renderer.SpriteBatch.prototype.constructor=Phaser.ParticleStorm.Renderer.SpriteBatch,Phaser.ParticleStorm.Renderer.SpriteBatch.prototype.add=function(a){var b=a.sprite,c=a.texture.key,d=a.texture.frame;return void 0===d&&void 0!==a.texture.frameName&&(d=a.texture.frameName),b?(b.reset(a.transform.x,a.transform.y),b.key!==c?b.loadTexture(c,d):void 0!==a.texture.frame?b.frame=d:void 0!==a.texture.frameName&&(b.frameName=d)):b=this.game.make.sprite(a.transform.x,a.transform.y,c,d),this.display.addChild(b),b.anchor.set(a.transform.anchor.x,a.transform.anchor.y),a.color.isTinted&&(b.tint=a.color.tint),b.blendMode=a.color.blendMode[0],b.texture.baseTexture.scaleMode=a.texture.scaleMode,b.visible=a.visible,a.sprite=b,b},Phaser.ParticleStorm.Renderer.SpriteBatch.prototype.update=function(a){var b=a.sprite;return a.delay>0&&!a.delayVisible?void(b.visible=!1):(b.visible=a.visible,b.alpha=a.color.alpha.calc,b.rotation=a.transform.rotation.calc,a.color.isTinted&&(b.tint=a.color.tint),b.scale.setTo(a.transform.scale.x.calc,a.transform.scale.y.calc),b.x=a.transform.x,void(b.y=a.transform.y))},Phaser.ParticleStorm.Renderer.SpriteBatch.prototype.kill=function(a){a.sprite&&a.sprite.kill()},Phaser.ParticleStorm.Renderer.SpriteBatch.prototype.destroy=function(){this.display.destroy(!0),this.emitter=null,this.game=null};